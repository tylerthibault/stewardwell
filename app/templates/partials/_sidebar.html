<div class="sidebar">
    <div class="sidebar-header">
        <h3>StewardWell</h3>
        <p class="welcome-message">
            Welcome, {{ current_user.username }}!
            {% if not current_user.is_parent %}
            <span class="coins-display">
                <i class="fas fa-coins"></i> {{ current_user.coins }}
            </span>
            {% endif %}
        </p>
    </div>

    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('main.index') }}">
                <i class="fas fa-home"></i> Home
            </a>
        </li>

        <!-- Family Section -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#familySubmenu" 
               data-bs-toggle="collapse" 
               aria-expanded="false">
                <i class="fas fa-users"></i> Family
                <i class="fas fa-chevron-down float-end"></i>
            </a>
            <div class="collapse" id="familySubmenu">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                            <i class="fas fa-chart-line"></i> Family Dashboard
                        </a>
                    </li>
                    {% if current_user.is_parent %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('family.members') }}">
                            <i class="fas fa-user-friends"></i> Members
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </li>

        <!-- Economy Module -->
        {% set module_settings = current_user.family.module_settings|list if current_user.family else [] %}
        {% set economy_module = module_settings|selectattr('module_name', 'equalto', 'economy')|list %}
        {% set admin_module = module_settings|selectattr('module_name', 'equalto', 'admin')|list %}

        {% set economy_enabled = not economy_module or economy_module[0].is_enabled if economy_module else true %}
        {% set admin_enabled = current_user.is_superuser and (not admin_module or admin_module[0].is_enabled if admin_module else true) %}

        {% if economy_enabled %}
        <li class="nav-item">
            <a class="nav-link collapsed" href="#economySubmenu" 
               data-bs-toggle="collapse" 
               aria-expanded="false">
                <i class="fas fa-coins"></i> Economy
                <i class="fas fa-chevron-down float-end"></i>
            </a>
            <div class="collapse" id="economySubmenu">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('chores.list_chores') }}">
                            <i class="fas fa-tasks"></i> Chores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('rewards.list_rewards') }}">
                            <i class="fas fa-gift"></i> Rewards
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('goals.list_goals') }}">
                            <i class="fas fa-flag"></i> Goals
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('rewards.purchase_history') }}">
                            <i class="fas fa-history"></i> Purchase History
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        {% endif %}

        <!-- Admin Module -->
        {% if admin_enabled %}
        <li class="nav-item">
            <a class="nav-link collapsed" href="#adminSubmenu" 
               data-bs-toggle="collapse" 
               aria-expanded="false">
                <i class="fas fa-shield-alt"></i> Admin
                <i class="fas fa-chevron-down float-end"></i>
            </a>
            <div class="collapse" id="adminSubmenu">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.manage_users') }}">
                            <i class="fas fa-users-cog"></i> Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.reset_db') }}">
                            <i class="fas fa-database"></i> Reset Database
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.seed_db') }}">
                            <i class="fas fa-seedling"></i> Seed Database
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        {% endif %}

        <!-- Settings Section (for both parents and children) -->
        <li class="nav-item">
            {% if current_user.is_parent %}
            <a class="nav-link" href="{{ url_for('settings.profile') }}">
                <i class="fas fa-cog"></i> Settings
            </a>
            {% else %}
            <a class="nav-link" href="{{ url_for('settings.child_profile') }}">
                <i class="fas fa-cog"></i> My Profile
            </a>
            {% endif %}
        </li>

        <!-- Logout -->
        <li class="nav-item mt-auto">
            <a class="nav-link" href="{{ url_for('auth.logout') }}">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </li>
    </ul>
</div>

<style>
.sidebar {
    min-width: 250px;
    max-width: 250px;
    min-height: 100vh;
    background: #343a40;
    color: #fff;
    transition: all 0.3s;
}

.sidebar .nav-link {
    color: rgba(255, 255, 255, 0.8);
    padding: 10px 20px;
    transition: all 0.3s;
}

.sidebar .nav-link:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
}

.sidebar .nav-link i {
    margin-right: 10px;
    width: 20px;
    text-align: center;
}

.sidebar .nav-link[aria-expanded="true"] .fa-chevron-down {
    transform: rotate(180deg);
}

.sidebar .nav-link .fa-chevron-down {
    transition: transform 0.3s;
}

.sidebar-header {
    padding: 20px;
    background: rgba(0, 0, 0, 0.1);
}

.sidebar-header h3 {
    margin: 0;
    font-size: 1.5rem;
    margin-bottom: 8px;
}

.welcome-message {
    font-size: 0.9rem;
    margin: 0;
    color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.coins-display {
    background: rgba(255, 215, 0, 0.2);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.85rem;
}

.coins-display i {
    color: #ffd700;
    margin-right: 4px;
}

.sidebar .collapse .nav-link {
    padding-left: 40px;
}

.sidebar .nav-item {
    margin-bottom: 5px;
}

.sidebar .collapse {
    background: rgba(0, 0, 0, 0.1);
}
</style> 